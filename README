Принцип работы бэкенда WhatClient

Бэкенд WhatClient — это сервис-посредник, который позволяет пользователям плагина анонимно запрашивать информацию о Telegram-клиенте друг друга. Архитектура построена на FastAPI и использует временные сессии для обмена данными, не храня постоянно никакой информации о пользователях.

Основная логика

Процесс полностью зависит от того, что у обоих пользователей (запрашивающего и того, чью информацию запрашивают) установлен и активен плагин.

1.  Запрос информации (Алиса -> Сервер)
    *   Пользователь Алиса вводит команду `.wc [ID Боба]`.
    *   Плагин Алисы отправляет на сервер запрос (`POST /requestClient`), содержащий её ID и ID Боба.
    *   Сервер создает "задачу на проверку" с уникальным `request_id` и сохраняет её во временном хранилище, ожидая ответа от клиента Боба.

2.  Опрос и ответ (Боб -> Сервер)
    *   Плагин Боба периодически (в фоновом режиме) опрашивает сервер (`GET /getTasks/{user_id}`), есть ли для него активные задачи.
    *   Обнаружив запрос от Алисы, плагин Боба выполняет локальную проверку, получает имя своего пакета (`package_name`) и отправляет его на сервер (`POST /submitTaskResult`) в качестве ответа на задачу.

3.  Получение результата (Алиса -> Сервер)
    *   Плагин Алисы, после отправки первоначального запроса, начинает опрашивать сервер (`GET /getRequestResult/{request_id}`) о статусе своей задачи.
    *   Как только сервер получает ответ от Боба, он помечает задачу как выполненную и сохраняет результат (имя клиента Боба).
    *   При следующем опросе плагин Алисы получает результат и отображает его в виде уведомления.

Ключевые особенности

*   Анонимность и безопасность: Сервер не хранит историю запросов или личные данные. Все сессии и задачи являются временными (удаляются через несколько минут).
*   Работа в моменте: Определение клиента возможно только если оба пользователя онлайн и у них активен плагин.
*   Отсутствие прямого P2P-соединения: Всё взаимодействие происходит через центральный сервер, который выступает в роли безопасного посредника. 